/**
 * @fileoverview added by tsickle
 * Generated from: lib/ng-terminal.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ViewChild, ElementRef, Input, Output, EventEmitter } from '@angular/core';
import { Terminal } from 'xterm';
import { FitAddon } from 'xterm-addon-fit';
import { Subject, combineLatest } from 'rxjs';
var NgTerminalComponent = /** @class */ (function () {
    function NgTerminalComponent() {
        this.keyInputSubject = new Subject();
        this.keyEventSubject = new Subject();
        this.termSnippetSubject = new Subject();
        this.afterViewInitSubject = new Subject();
        this.h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
        this.displayOption = {};
        this.terminalStyle = {};
        this.keyInputEmitter = new EventEmitter();
        this.keyEventEmitter = new EventEmitter();
        this.termSnippetSubscription = combineLatest(this.termSnippetSubject, this.afterViewInitSubject).subscribe((/**
         * @param {?} __0
         * @return {?}
         */
        function (_a) {
            var _b = tslib_1.__read(_a, 1), snippet = _b[0];
            snippet();
        }));
    }
    Object.defineProperty(NgTerminalComponent.prototype, "_dataSource", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dataSource;
        },
        set: /**
         * @param {?} ds
         * @return {?}
         */
        function (ds) {
            var _this = this;
            if (this.dataSourceSubscription != null) {
                this.dataSourceSubscription.unsubscribe();
            }
            this.dataSource = ds;
            this.dataSourceSubscription = this.dataSource.subscribe((/**
             * @param {?} data
             * @return {?}
             */
            function (data) {
                _this.write(data);
            }));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "_displayOption", {
        set: /**
         * @param {?} opt
         * @return {?}
         */
        function (opt) {
            this.setDisplayOption(opt);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "_style", {
        set: /**
         * @param {?} opt
         * @return {?}
         */
        function (opt) {
            this.setStyle(opt);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @return {?}
     */
    NgTerminalComponent.prototype.observableSetup = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.term.onData((/**
         * @param {?} input
         * @return {?}
         */
        function (input) {
            _this.keyInputSubject.next(input);
        }));
        this.term.onKey((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.keyEventSubject.next(e);
        }));
        this.keyInputSubjectSubscription = this.keyInputSubject.subscribe((/**
         * @param {?} data
         * @return {?}
         */
        function (data) {
            _this.keyInputEmitter.emit(data);
        }));
        this.keyEventSubjectSubscription = this.keyEventSubject.subscribe((/**
         * @param {?} e
         * @return {?}
         */
        function (e) {
            _this.keyEventEmitter.emit(e);
        }));
        this.afterViewInitSubject.next();
    };
    /**
     * set block or inline-block to #terminal for fitting client or outer element
     */
    /**
     * set block or inline-block to #terminal for fitting client or outer element
     * @private
     * @param {?} isBlock
     * @return {?}
     */
    NgTerminalComponent.prototype.setTerminalBlock = /**
     * set block or inline-block to #terminal for fitting client or outer element
     * @private
     * @param {?} isBlock
     * @return {?}
     */
    function (isBlock) {
        if (isBlock)
            this.terminalStyle['display'] = 'block';
        else
            this.terminalStyle['display'] = 'inline-block';
    };
    /**
     * set dimensions
     */
    /**
     * set dimensions
     * @private
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    NgTerminalComponent.prototype.setTerminalDimensions = /**
     * set dimensions
     * @private
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    function (left, top, width, height) {
        this.terminalStyle['left'] = left ? left + "px" : undefined;
        this.terminalStyle['top'] = top ? top + "px" : undefined;
        this.terminalStyle['width'] = width ? width + "px" : undefined;
        this.terminalStyle['height'] = height ? height + "px" : undefined;
    };
    /**
     * remove dimensions
     */
    /**
     * remove dimensions
     * @private
     * @return {?}
     */
    NgTerminalComponent.prototype.removeTerminalDimensions = /**
     * remove dimensions
     * @private
     * @return {?}
     */
    function () {
        this.terminalStyle['left'] = undefined;
        this.terminalStyle['top'] = undefined;
        this.terminalStyle['width'] = undefined;
        this.terminalStyle['height'] = undefined;
    };
    /**
     * @param {?} styleObject
     * @return {?}
     */
    NgTerminalComponent.prototype.setStyle = /**
     * @param {?} styleObject
     * @return {?}
     */
    function (styleObject) {
        Object.assign(this.terminalStyle, styleObject);
    };
    /**
     * @return {?}
     */
    NgTerminalComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * When a dimension of div changes, fit a terminal in div.
     */
    /**
     * When a dimension of div changes, fit a terminal in div.
     * @return {?}
     */
    NgTerminalComponent.prototype.ngAfterViewChecked = /**
     * When a dimension of div changes, fit a terminal in div.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var dims = this.fitAddon.proposeDimensions();
        if (dims === undefined || isNaN(dims.rows) || dims.rows == Infinity || isNaN(dims.cols) || dims.cols == Infinity) {
            this.term.resize(10, 10);
        }
        else if (!this.displayOption.fixedGrid) {
            this.fitAddon.fit();
        }
        else {
            this.term.resize(this.displayOption.fixedGrid.cols, this.displayOption.fixedGrid.rows);
            /** @type {?} */
            var xtermScreen = this.term.element.getElementsByClassName('xterm-screen')[0];
            /** @type {?} */
            var scrollArea = this.term.element.getElementsByClassName('xterm-scroll-area')[0];
            /** @type {?} */
            var terminal = this.term.element;
            /** @type {?} */
            var contentWidth = xtermScreen.clientWidth;
            /** @type {?} */
            var scrollWidth = terminal.clientWidth - scrollArea.clientWidth;
            this.setTerminalDimensions(undefined, undefined, contentWidth + scrollWidth, undefined);
        }
    };
    /**
     * It creates new terminal in #terminal.
     */
    /**
     * It creates new terminal in #terminal.
     * @return {?}
     */
    NgTerminalComponent.prototype.ngAfterViewInit = /**
     * It creates new terminal in #terminal.
     * @return {?}
     */
    function () {
        this.fitAddon = new FitAddon();
        this.term = new Terminal();
        this.term.open(this.terminalDiv.nativeElement);
        this.term.loadAddon(this.fitAddon);
        this.observableSetup();
    };
    /**
     * clean all resources
     */
    /**
     * clean all resources
     * @return {?}
     */
    NgTerminalComponent.prototype.ngOnDestroy = /**
     * clean all resources
     * @return {?}
     */
    function () {
        if (this.keyInputSubjectSubscription)
            this.keyInputSubjectSubscription.unsubscribe();
        if (this.dataSourceSubscription)
            this.dataSourceSubscription.unsubscribe();
        if (this.keyEventSubjectSubscription)
            this.keyEventSubjectSubscription.unsubscribe();
        if (this.termSnippetSubscription)
            this.termSnippetSubscription.unsubscribe();
        if (this.term)
            this.term.dispose();
    };
    /**
     * @param {?} chars
     * @return {?}
     */
    NgTerminalComponent.prototype.write = /**
     * @param {?} chars
     * @return {?}
     */
    function (chars) {
        this.term.write(chars);
    };
    /**
     * @param {?} opt
     * @return {?}
     */
    NgTerminalComponent.prototype.setDisplayOption = /**
     * @param {?} opt
     * @return {?}
     */
    function (opt) {
        if (opt) {
            if (opt.fixedGrid != null) {
                console.debug("resizable will be ignored.");
                this.setTerminalBlock(false);
                this.removeTerminalDimensions();
            }
            else {
                this.setTerminalBlock(true);
            }
            this.displayOption = opt;
        }
        else
            console.warn("A falsy option is not allowed");
    };
    Object.defineProperty(NgTerminalComponent.prototype, "keyInput", {
        get: /**
         * @return {?}
         */
        function () {
            return this.keyInputSubject;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "keyEventInput", {
        get: /**
         * @return {?}
         */
        function () {
            return this.keyEventSubject;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "underlying", {
        get: /**
         * @return {?}
         */
        function () {
            return this.term;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgTerminalComponent.prototype, "isDraggableOnEdgeActivated", {
        get: /**
         * @return {?}
         */
        function () {
            return this.displayOption.activateDraggableOnEdge != undefined && this.displayOption.fixedGrid == undefined;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * After user coordinate dimensions of terminal, it's called.
     * @param left
     * @param top
     * @param width
     * @param height
     */
    /**
     * After user coordinate dimensions of terminal, it's called.
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    NgTerminalComponent.prototype.onResizeEnd = /**
     * After user coordinate dimensions of terminal, it's called.
     * @param {?} left
     * @param {?} top
     * @param {?} width
     * @param {?} height
     * @return {?}
     */
    function (left, top, width, height) {
        this.setTerminalDimensions(left, top, width, height);
    };
    /**
     * Before onResizeEnd is called, it valiates dimensions to change.
     * @param re dimension to be submitted from resizable stuff
     */
    /**
     * Before onResizeEnd is called, it valiates dimensions to change.
     * @return {?}
     */
    NgTerminalComponent.prototype.validatorFactory = /**
     * Before onResizeEnd is called, it valiates dimensions to change.
     * @return {?}
     */
    function () {
        /** @type {?} */
        var comp = this;
        return (/**
         * @param {?} re
         * @return {?}
         */
        function (re) {
            /** @type {?} */
            var displayOption = comp.displayOption;
            if (displayOption.activateDraggableOnEdge) {
                /** @type {?} */
                var left = re.rectangle.left;
                /** @type {?} */
                var top_1 = re.rectangle.top;
                /** @type {?} */
                var width = re.rectangle.width;
                /** @type {?} */
                var height = re.rectangle.height;
                if ((width < displayOption.activateDraggableOnEdge.minWidth) || (height < displayOption.activateDraggableOnEdge.minHeight)) {
                    return false;
                }
                else
                    return true;
            }
        });
    };
    NgTerminalComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-terminal',
                    template: "<global-style></global-style>\n\n<div #terminal class=\"terminal-outer\" mwlResizable [ngStyle]=\"terminalStyle\" [validateResize]=\"validatorFactory()\" [enableGhostResize]=\"true\" [resizeEdges]=\"isDraggableOnEdgeActivated ? {bottom: true, right: true} : {bottom: false, right: false}\"\n(resizeEnd)=\"onResizeEnd($event.rectangle.left, $event.rectangle.top, $event.rectangle.width, $event.rectangle.height)\">\n</div>",
                    styles: [".terminal-outer{box-sizing:border-box;height:100%}"]
                }] }
    ];
    /** @nocollapse */
    NgTerminalComponent.ctorParameters = function () { return []; };
    NgTerminalComponent.propDecorators = {
        _dataSource: [{ type: Input, args: ['dataSource',] }],
        _displayOption: [{ type: Input, args: ['displayOption',] }],
        _style: [{ type: Input, args: ['style',] }],
        keyInputEmitter: [{ type: Output, args: ['keyInput',] }],
        keyEventEmitter: [{ type: Output, args: ['keyEvent',] }],
        terminalDiv: [{ type: ViewChild, args: ['terminal', { static: true },] }]
    };
    return NgTerminalComponent;
}());
export { NgTerminalComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.term;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.fitAddon;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyInputSubject;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyEventSubject;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.termSnippetSubject;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.afterViewInitSubject;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyInputSubjectSubscription;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.keyEventSubjectSubscription;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.termSnippetSubscription;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.h;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.displayOption;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.dataSource;
    /**
     * @type {?}
     * @private
     */
    NgTerminalComponent.prototype.dataSourceSubscription;
    /** @type {?} */
    NgTerminalComponent.prototype.terminalStyle;
    /** @type {?} */
    NgTerminalComponent.prototype.keyInputEmitter;
    /** @type {?} */
    NgTerminalComponent.prototype.keyEventEmitter;
    /** @type {?} */
    NgTerminalComponent.prototype.terminalDiv;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctdGVybWluYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmctdGVybWluYWwvIiwic291cmNlcyI6WyJsaWIvbmctdGVybWluYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQTRCLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQTRCLE1BQU0sZUFBZSxDQUFDO0FBQ2xKLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDakMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxPQUFPLEVBQTRCLGFBQWEsRUFBMkIsTUFBTSxNQUFNLENBQUM7QUFJakc7SUF1REU7UUEvQ1Esb0JBQWUsR0FBb0IsSUFBSSxPQUFPLEVBQVUsQ0FBQztRQUN6RCxvQkFBZSxHQUFHLElBQUksT0FBTyxFQUEyQyxDQUFDO1FBQ3pFLHVCQUFrQixHQUFHLElBQUksT0FBTyxFQUFZLENBQUM7UUFDN0MseUJBQW9CLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUszQyxNQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLFlBQVksRUFBRSxNQUFNLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzdFLGtCQUFhLEdBQWtCLEVBQUUsQ0FBQztRQUcxQyxrQkFBYSxHQUFXLEVBQUUsQ0FBQztRQTJCM0Isb0JBQWUsR0FBSSxJQUFJLFlBQVksRUFBVSxDQUFDO1FBRzlDLG9CQUFlLEdBQUksSUFBSSxZQUFZLEVBQTJDLENBQUM7UUFNN0UsSUFBSSxDQUFDLHVCQUF1QixHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUMsU0FBUzs7OztRQUFDLFVBQUMsRUFBUztnQkFBVCwwQkFBUyxF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Q3BCO1FBQ0gsQ0FBQyxFQUFBO0lBQ0gsQ0FBQzs7Z0JBN05GLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsYUFBYTtvQkFDdkIsaWJBQTJDOztpQkFFNUM7Ozs7OzhCQWtCRSxLQUFLLFNBQUMsWUFBWTtpQ0FjbEIsS0FBSyxTQUFDLGVBQWU7eUJBS3JCLEtBQUssU0FBQyxPQUFPO2tDQUtiLE1BQU0sU0FBQyxVQUFVO2tDQUdqQixNQUFNLFNBQUMsVUFBVTs4QkFHakIsU0FBUyxTQUFDLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7O0lBMEt6QywwQkFBQztDQUFBLEFBOU5ELElBOE5DO1NBek5ZLG1CQUFtQjs7Ozs7O0lBQzlCLG1DQUF1Qjs7Ozs7SUFDdkIsdUNBQTJCOzs7OztJQUMzQiw4Q0FBaUU7Ozs7O0lBQ2pFLDhDQUFpRjs7Ozs7SUFDakYsaURBQXFEOzs7OztJQUNyRCxtREFBbUQ7Ozs7O0lBRW5ELDBEQUFrRDs7Ozs7SUFDbEQsMERBQWtEOzs7OztJQUNsRCxzREFBOEM7Ozs7O0lBQzlDLGdDQUFxRjs7Ozs7SUFDckYsNENBQTBDOzs7OztJQUMxQyx5Q0FBdUM7Ozs7O0lBQ3ZDLHFEQUE2Qzs7SUFDN0MsNENBQTJCOztJQTBCM0IsOENBQzhDOztJQUU5Qyw4Q0FDK0U7O0lBRS9FLDBDQUN3QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBBZnRlclZpZXdDaGVja2VkLCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBUZXJtaW5hbCB9IGZyb20gJ3h0ZXJtJztcbmltcG9ydCB7IEZpdEFkZG9uIH0gZnJvbSAneHRlcm0tYWRkb24tZml0JztcbmltcG9ydCB7IE5nVGVybWluYWwgfSBmcm9tICcuL25nLXRlcm1pbmFsJztcbmltcG9ydCB7IFN1YmplY3QsIE9ic2VydmFibGUsIFN1YnNjcmlwdGlvbiwgY29tYmluZUxhdGVzdCwgT2JqZWN0VW5zdWJzY3JpYmVkRXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IERpc3BsYXlPcHRpb24gfSBmcm9tICcuL2Rpc3BsYXktb3B0aW9uJztcbmltcG9ydCB7IFJlc2l6ZUV2ZW50IH0gZnJvbSAnYW5ndWxhci1yZXNpemFibGUtZWxlbWVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nLXRlcm1pbmFsJyxcbiAgdGVtcGxhdGVVcmw6ICcuL25nLXRlcm1pbmFsLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbmctdGVybWluYWwuY29tcG9uZW50LmNzcyddXG59KVxuZXhwb3J0IGNsYXNzIE5nVGVybWluYWxDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQsIEFmdGVyVmlld0NoZWNrZWQsIE5nVGVybWluYWwsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgdGVybTogVGVybWluYWw7XG4gIHByaXZhdGUgZml0QWRkb246IEZpdEFkZG9uO1xuICBwcml2YXRlIGtleUlucHV0U3ViamVjdDogU3ViamVjdDxzdHJpbmc+ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuICBwcml2YXRlIGtleUV2ZW50U3ViamVjdCA9IG5ldyBTdWJqZWN0PHtrZXk6IHN0cmluZzsgZG9tRXZlbnQ6IEtleWJvYXJkRXZlbnQ7fT4oKTtcbiAgcHJpdmF0ZSB0ZXJtU25pcHBldFN1YmplY3QgPSBuZXcgU3ViamVjdDwoKT0+dm9pZD4oKTtcbiAgcHJpdmF0ZSBhZnRlclZpZXdJbml0U3ViamVjdCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG4gIFxuICBwcml2YXRlIGtleUlucHV0U3ViamVjdFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIGtleUV2ZW50U3ViamVjdFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuICBwcml2YXRlIHRlcm1TbmlwcGV0U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgaCA9IE1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lckhlaWdodCB8fCAwKTtcbiAgcHJpdmF0ZSBkaXNwbGF5T3B0aW9uOiBEaXNwbGF5T3B0aW9uID0ge307XG4gIHByaXZhdGUgZGF0YVNvdXJjZTogT2JzZXJ2YWJsZTxzdHJpbmc+O1xuICBwcml2YXRlIGRhdGFTb3VyY2VTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgdGVybWluYWxTdHlsZTogb2JqZWN0ID0ge307XG5cbiAgQElucHV0KCdkYXRhU291cmNlJylcbiAgc2V0IF9kYXRhU291cmNlKGRzKSB7XG4gICAgaWYodGhpcy5kYXRhU291cmNlU3Vic2NyaXB0aW9uICE9IG51bGwpe1xuICAgICAgdGhpcy5kYXRhU291cmNlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICAgIHRoaXMuZGF0YVNvdXJjZSA9IGRzO1xuICAgIHRoaXMuZGF0YVNvdXJjZVN1YnNjcmlwdGlvbiA9IHRoaXMuZGF0YVNvdXJjZS5zdWJzY3JpYmUoKGRhdGEpID0+IHtcbiAgICAgIHRoaXMud3JpdGUoZGF0YSk7XG4gICAgfSlcbiAgfVxuICBnZXQgX2RhdGFTb3VyY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YVNvdXJjZTtcbiAgfVxuXG4gIEBJbnB1dCgnZGlzcGxheU9wdGlvbicpXG4gIHNldCBfZGlzcGxheU9wdGlvbihvcHQ6IERpc3BsYXlPcHRpb24pe1xuICAgIHRoaXMuc2V0RGlzcGxheU9wdGlvbihvcHQpO1xuICB9XG5cbiAgQElucHV0KCdzdHlsZScpXG4gIHNldCBfc3R5bGUob3B0OiBhbnkpe1xuICAgIHRoaXMuc2V0U3R5bGUob3B0KTtcbiAgfVxuXG4gIEBPdXRwdXQoJ2tleUlucHV0JylcbiAga2V5SW5wdXRFbWl0dGVyICA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuXG4gIEBPdXRwdXQoJ2tleUV2ZW50JylcbiAga2V5RXZlbnRFbWl0dGVyICA9IG5ldyBFdmVudEVtaXR0ZXI8e2tleTogc3RyaW5nOyBkb21FdmVudDogS2V5Ym9hcmRFdmVudDt9PigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3Rlcm1pbmFsJywgeyBzdGF0aWM6IHRydWUgfSkgXG4gIHRlcm1pbmFsRGl2OiBFbGVtZW50UmVmO1xuXG4gIGNvbnN0cnVjdG9yKCkgeyBcbiAgICB0aGlzLnRlcm1TbmlwcGV0U3Vic2NyaXB0aW9uID0gY29tYmluZUxhdGVzdCh0aGlzLnRlcm1TbmlwcGV0U3ViamVjdCwgdGhpcy5hZnRlclZpZXdJbml0U3ViamVjdCkuc3Vic2NyaWJlKChbc25pcHBldF0pID0+IHtcbiAgICAgIHNuaXBwZXQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb2JzZXJ2YWJsZVNldHVwKCl7XG4gICAgdGhpcy50ZXJtLm9uRGF0YSgoaW5wdXQpID0+IHtcbiAgICAgIHRoaXMua2V5SW5wdXRTdWJqZWN0Lm5leHQoaW5wdXQpO1xuICAgIH0pO1xuICAgIHRoaXMudGVybS5vbktleShlID0+IHtcbiAgICAgIHRoaXMua2V5RXZlbnRTdWJqZWN0Lm5leHQoZSk7XG4gICAgfSlcbiAgICB0aGlzLmtleUlucHV0U3ViamVjdFN1YnNjcmlwdGlvbiA9IHRoaXMua2V5SW5wdXRTdWJqZWN0LnN1YnNjcmliZSgoZGF0YSkgPT4ge1xuICAgICAgdGhpcy5rZXlJbnB1dEVtaXR0ZXIuZW1pdChkYXRhKTtcbiAgICB9KVxuICAgIHRoaXMua2V5RXZlbnRTdWJqZWN0U3Vic2NyaXB0aW9uID0gdGhpcy5rZXlFdmVudFN1YmplY3Quc3Vic2NyaWJlKChlKSA9PiB7XG4gICAgICB0aGlzLmtleUV2ZW50RW1pdHRlci5lbWl0KGUpO1xuICAgIH0pO1xuICAgIHRoaXMuYWZ0ZXJWaWV3SW5pdFN1YmplY3QubmV4dCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIHNldCBibG9jayBvciBpbmxpbmUtYmxvY2sgdG8gI3Rlcm1pbmFsIGZvciBmaXR0aW5nIGNsaWVudCBvciBvdXRlciBlbGVtZW50XG4gICAqL1xuICBwcml2YXRlIHNldFRlcm1pbmFsQmxvY2soaXNCbG9jazogYm9vbGVhbil7XG4gICAgaWYoaXNCbG9jaylcbiAgICAgIHRoaXMudGVybWluYWxTdHlsZVsnZGlzcGxheSddID0gJ2Jsb2NrJztcbiAgICBlbHNlXG4gICAgICB0aGlzLnRlcm1pbmFsU3R5bGVbJ2Rpc3BsYXknXSA9ICdpbmxpbmUtYmxvY2snO1xuICB9XG5cbiAgLyoqXG4gICAqIHNldCBkaW1lbnNpb25zXG4gICAqL1xuICBwcml2YXRlIHNldFRlcm1pbmFsRGltZW5zaW9ucyhsZWZ0OiBudW1iZXIsIHRvcDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIHRoaXMudGVybWluYWxTdHlsZVsnbGVmdCddID0gbGVmdCA/IGAke2xlZnR9cHhgIDogdW5kZWZpbmVkO1xuICAgIHRoaXMudGVybWluYWxTdHlsZVsndG9wJ10gPSB0b3AgPyBgJHt0b3B9cHhgIDogdW5kZWZpbmVkO1xuICAgIHRoaXMudGVybWluYWxTdHlsZVsnd2lkdGgnXSA9IHdpZHRoID8gYCR7d2lkdGh9cHhgIDogdW5kZWZpbmVkO1xuICAgIHRoaXMudGVybWluYWxTdHlsZVsnaGVpZ2h0J10gPSBoZWlnaHQgPyBgJHtoZWlnaHR9cHhgIDogdW5kZWZpbmVkO1xuICB9XG4gIFxuICAvKipcbiAgICogcmVtb3ZlIGRpbWVuc2lvbnNcbiAgICovXG4gIHByaXZhdGUgcmVtb3ZlVGVybWluYWxEaW1lbnNpb25zKCl7XG4gICAgdGhpcy50ZXJtaW5hbFN0eWxlWydsZWZ0J10gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50ZXJtaW5hbFN0eWxlWyd0b3AnXSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnRlcm1pbmFsU3R5bGVbJ3dpZHRoJ10gPSB1bmRlZmluZWQ7XG4gICAgdGhpcy50ZXJtaW5hbFN0eWxlWydoZWlnaHQnXSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHNldFN0eWxlKHN0eWxlT2JqZWN0OiBhbnkpe1xuICAgIE9iamVjdC5hc3NpZ24odGhpcy50ZXJtaW5hbFN0eWxlLCBzdHlsZU9iamVjdCk7XG4gIH1cblxuICBuZ09uSW5pdCgpe1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gYSBkaW1lbnNpb24gb2YgZGl2IGNoYW5nZXMsIGZpdCBhIHRlcm1pbmFsIGluIGRpdi5cbiAgICovXG4gIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICBsZXQgZGltcyA9IHRoaXMuZml0QWRkb24ucHJvcG9zZURpbWVuc2lvbnMoKTtcbiAgICBpZihkaW1zID09PSB1bmRlZmluZWQgfHwgaXNOYU4oZGltcy5yb3dzKSB8fCBkaW1zLnJvd3MgPT0gSW5maW5pdHkgfHwgaXNOYU4oZGltcy5jb2xzKSB8fCBkaW1zLmNvbHMgPT0gSW5maW5pdHkpe1xuICAgICAgdGhpcy50ZXJtLnJlc2l6ZSgxMCwgMTApO1xuICAgIH1lbHNlIGlmKCF0aGlzLmRpc3BsYXlPcHRpb24uZml4ZWRHcmlkKXtcbiAgICAgIHRoaXMuZml0QWRkb24uZml0KCk7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnRlcm0ucmVzaXplKHRoaXMuZGlzcGxheU9wdGlvbi5maXhlZEdyaWQuY29scywgdGhpcy5kaXNwbGF5T3B0aW9uLmZpeGVkR3JpZC5yb3dzKTtcbiAgICAgIGxldCB4dGVybVNjcmVlbiA9IHRoaXMudGVybS5lbGVtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3h0ZXJtLXNjcmVlbicpWzBdO1xuICAgICAgbGV0IHNjcm9sbEFyZWEgPSB0aGlzLnRlcm0uZWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd4dGVybS1zY3JvbGwtYXJlYScpWzBdO1xuICAgICAgbGV0IHRlcm1pbmFsID0gdGhpcy50ZXJtLmVsZW1lbnQ7XG4gICAgICBjb25zdCBjb250ZW50V2lkdGggPSB4dGVybVNjcmVlbi5jbGllbnRXaWR0aDtcbiAgICAgIGNvbnN0IHNjcm9sbFdpZHRoID0gdGVybWluYWwuY2xpZW50V2lkdGggLSBzY3JvbGxBcmVhLmNsaWVudFdpZHRoO1xuICAgICAgdGhpcy5zZXRUZXJtaW5hbERpbWVuc2lvbnModW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRlbnRXaWR0aCArIHNjcm9sbFdpZHRoLCB1bmRlZmluZWQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJdCBjcmVhdGVzIG5ldyB0ZXJtaW5hbCBpbiAjdGVybWluYWwuXG4gICAqL1xuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5maXRBZGRvbiA9IG5ldyBGaXRBZGRvbigpO1xuICAgIHRoaXMudGVybSA9IG5ldyBUZXJtaW5hbCgpO1xuICAgIHRoaXMudGVybS5vcGVuKHRoaXMudGVybWluYWxEaXYubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy50ZXJtLmxvYWRBZGRvbih0aGlzLmZpdEFkZG9uKTtcbiAgICB0aGlzLm9ic2VydmFibGVTZXR1cCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIGNsZWFuIGFsbCByZXNvdXJjZXNcbiAgICovXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmKHRoaXMua2V5SW5wdXRTdWJqZWN0U3Vic2NyaXB0aW9uKVxuICAgICAgdGhpcy5rZXlJbnB1dFN1YmplY3RTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICBpZih0aGlzLmRhdGFTb3VyY2VTdWJzY3JpcHRpb24pXG4gICAgICB0aGlzLmRhdGFTb3VyY2VTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICBpZih0aGlzLmtleUV2ZW50U3ViamVjdFN1YnNjcmlwdGlvbilcbiAgICAgIHRoaXMua2V5RXZlbnRTdWJqZWN0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgaWYodGhpcy50ZXJtU25pcHBldFN1YnNjcmlwdGlvbilcbiAgICB0aGlzLnRlcm1TbmlwcGV0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgaWYodGhpcy50ZXJtKVxuICAgICAgdGhpcy50ZXJtLmRpc3Bvc2UoKTtcbiAgfVxuXG4gIHdyaXRlKGNoYXJzOiBzdHJpbmcpIHtcbiAgICB0aGlzLnRlcm0ud3JpdGUoY2hhcnMpO1xuICB9XG5cbiAgc2V0RGlzcGxheU9wdGlvbihvcHQ6IERpc3BsYXlPcHRpb24pIHtcbiAgICBpZiAob3B0KSB7XG4gICAgICBpZiAob3B0LmZpeGVkR3JpZCAhPSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUuZGVidWcoXCJyZXNpemFibGUgd2lsbCBiZSBpZ25vcmVkLlwiKTtcbiAgICAgICAgdGhpcy5zZXRUZXJtaW5hbEJsb2NrKGZhbHNlKTtcbiAgICAgICAgdGhpcy5yZW1vdmVUZXJtaW5hbERpbWVuc2lvbnMoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0VGVybWluYWxCbG9jayh0cnVlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZGlzcGxheU9wdGlvbiA9IG9wdDtcbiAgICB9IGVsc2VcbiAgICAgIGNvbnNvbGUud2FybihgQSBmYWxzeSBvcHRpb24gaXMgbm90IGFsbG93ZWRgKTtcbiAgfVxuXG4gIGdldCBrZXlJbnB1dCgpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmtleUlucHV0U3ViamVjdDtcbiAgfVxuXG4gIGdldCBrZXlFdmVudElucHV0KCk6IE9ic2VydmFibGU8e2tleTogc3RyaW5nOyBkb21FdmVudDogS2V5Ym9hcmRFdmVudDt9PiB7XG4gICAgcmV0dXJuIHRoaXMua2V5RXZlbnRTdWJqZWN0O1xuICB9XG5cbiAgZ2V0IHVuZGVybHlpbmcoKTogVGVybWluYWwge1xuICAgIHJldHVybiB0aGlzLnRlcm07XG4gIH1cblxuICBnZXQgaXNEcmFnZ2FibGVPbkVkZ2VBY3RpdmF0ZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGlzcGxheU9wdGlvbi5hY3RpdmF0ZURyYWdnYWJsZU9uRWRnZSAhPSB1bmRlZmluZWQgJiYgdGhpcy5kaXNwbGF5T3B0aW9uLmZpeGVkR3JpZCA9PSB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogQWZ0ZXIgdXNlciBjb29yZGluYXRlIGRpbWVuc2lvbnMgb2YgdGVybWluYWwsIGl0J3MgY2FsbGVkLlxuICAgKiBAcGFyYW0gbGVmdCBcbiAgICogQHBhcmFtIHRvcCBcbiAgICogQHBhcmFtIHdpZHRoIFxuICAgKiBAcGFyYW0gaGVpZ2h0IFxuICAgKi9cbiAgb25SZXNpemVFbmQobGVmdDogbnVtYmVyLCB0b3A6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnNldFRlcm1pbmFsRGltZW5zaW9ucyhsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJlZm9yZSBvblJlc2l6ZUVuZCBpcyBjYWxsZWQsIGl0IHZhbGlhdGVzIGRpbWVuc2lvbnMgdG8gY2hhbmdlLlxuICAgKiBAcGFyYW0gcmUgZGltZW5zaW9uIHRvIGJlIHN1Ym1pdHRlZCBmcm9tIHJlc2l6YWJsZSBzdHVmZlxuICAgKi9cbiAgdmFsaWRhdG9yRmFjdG9yeSgpOiAocmU6IFJlc2l6ZUV2ZW50KSA9PiBib29sZWFuIHtcbiAgICBjb25zdCBjb21wID0gdGhpcztcbiAgICByZXR1cm4gKHJlOiBSZXNpemVFdmVudCkgPT57IFxuICAgICAgY29uc3QgZGlzcGxheU9wdGlvbiA9IGNvbXAuZGlzcGxheU9wdGlvbjtcbiAgICAgIGlmKGRpc3BsYXlPcHRpb24uYWN0aXZhdGVEcmFnZ2FibGVPbkVkZ2Upe1xuICAgICAgICBsZXQgbGVmdCA9IHJlLnJlY3RhbmdsZS5sZWZ0LCB0b3AgPSByZS5yZWN0YW5nbGUudG9wLCB3aWR0aCA9IHJlLnJlY3RhbmdsZS53aWR0aCwgaGVpZ2h0ID0gcmUucmVjdGFuZ2xlLmhlaWdodDtcbiAgICAgICAgaWYgKCh3aWR0aCA8IGRpc3BsYXlPcHRpb24uYWN0aXZhdGVEcmFnZ2FibGVPbkVkZ2UubWluV2lkdGgpIHx8IChoZWlnaHQgPCBkaXNwbGF5T3B0aW9uLmFjdGl2YXRlRHJhZ2dhYmxlT25FZGdlLm1pbkhlaWdodCkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdfQ==